<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">(function(){
	&quot;use strict&quot;;
})();

(function() {
	var global = this;

	if (typeof nutshell === 'undefined') {
		global.nutshell = {};
	}

	nutshell.global = global;
}());

var callbackBase = {
<span id='global-method-createInstance'>	/**
</span>	 * constructor method.
	 */
	createInstance : function(){
		var _public = {};
		
		//private properties
		var _private = {};
		
		var flagRegistered = false;
		var userCb = [];
		var hostApi = null;
			
		/// public methods
<span id='global-method-setApi'>	    /**
</span>	     * Set API which used by current callback class to change inner state.
	     *
	     */
	    _public.setApi = function(api){
	    	hostApi = api;
	    };	
	    
<span id='global-method-setCustomCallback'>		/**
</span>		 * Inner : 
		 * 
		 * @ignore
		 * 
		 */
		_public.setCustomCallback = function (setName, func){
			if( userCb[setName] != &quot;undefined&quot;){
				var usrCbName = 'User' + setName;
				if( func != &quot;undefined&quot; &amp;&amp; func != null ){
					userCb[usrCbName] = func;
				}
				else{
					//clear the callback function setting.
					delete userCb[usrCbName];
				}
			}
		};
		
<span id='global-method-getCustomCallback'>		/**
</span>		 * @private
		 */
		var getCustomCallback = function(setName){	
			var usrCbName = 'User' + setName;
			var usrFunc = userCb[usrCbName];
			return usrFunc;
		};
		
<span id='global-method-callCustomCallback'>		/**
</span>		 * @private
		 */
		var callCustomCallback = function(setName, responeArr){
			var usrFunc = getCustomCallback(setName);
			if( usrFunc != &quot;undefined&quot; &amp;&amp; usrFunc != null ){
				usrFunc.apply(this, responeArr);
			}
			else{
				console.log('userCb.' + setName + ' Unregistered!');
			}
		};		
		
<span id='global-method-handle'>		/**
</span>		 * Inner : handler of userCb
		 * 
		 * @ignore
		 * 
		 */
		_public.handle = function(funcCbName, responseJson){
			if( hostApi == undefined ){
				console.log('Callbackbase need a HostApi');
				return ;
			}
			
			var func = hostApi[funcCbName];	
			if( func != null ){
				
				var i = 0;
				var arg = [];
				for (var k in responseJson) {
					if (responseJson.hasOwnProperty(k)) {
						arg.push(responseJson[k]);
						i += 1;
					}
				}
				
				if( i &lt; func.length ){
					console.log('Callback fucntion : ' + funcCbName + ' need more arguments! response data failed?');
				}
				
				if( hostApi != undefined  ){	
					func = hostApi[funcCbName];
	        		if( typeof(func) == &quot;function&quot; &amp;&amp; func.apply(hostApi, arg) ){
	        			callCustomCallback(funcCbName, arg);
	        		}
	        	}
	
	
			}
			else{
				console.log('Undefined callback fucntion : ' + funcCbName + ' (' + responseJson + ')');
			}						
		};
		
<span id='global-method-registerMyself'>		/**
</span>		 * Inner : register userCb
		 * 
		 * @ignore
		 */
		_public.registerMyself = function(){
			
			if( flagRegistered ){
				return;
			}
			else {						
				var call_id = GetCallID();
				
				var callInfo = {
					instance : null, 
			        handle : function(responseJson){
			            _public.handle.call(callInfo.instance, responseJson.settingName,responseJson.fitAll);
			          }					
				}
				callInfo.instance = _public;
				
				pendingCalls[call_id] = callInfo;
							       
			    flagRegistered = true;
		    }
		
		};
		
		_public.isRegistered = function(){
			return flagRegistered;
		},
					
<span id='global-property-'>		/**
</span>		 * Inner 
		 * 
		 * @ignore
		 */
		_public.unregisterMyself = function(){
			if( flagRegistered ){
				//TODO:
			}
		};	    

		//return the Insance;
		return _public;
	}
};

/*
 * This file is extend Javascript interface of SmartAuto platform.
 * 
 */


// @tag nutshell,extJs
// @define nutshell.navi
// @require nutshell

<span id='nutshell-navi'>/**
</span> * @class nutshell.navi
 * 
 * navi
 * @singleton
 */
(function() {

	function long64(number, unsigned){
		return dcodeIO.Long.fromNumber(number, unsigned);
	}
<span id='nutshell-navi-method-createMapOperatorPoint'>	/**
</span>    * private
    */
    function createMapOperatorPoint(x, y , timer) {
    	var point = new naviTransfer.MapOperator.Point();
		point.setX(x);
		point.setY(y);
		point.setTimer(timer);
		return point;
    }
<span id='nutshell-navi-method-getLocation'>    /**
</span>    * 取得实时的GPS
    */
  	function getLocation(callback, scope) {
  		if(navigator.geolocation) {
  			scope = scope || window;
  			navigator.geolocation.getCurrentPosition(function(position) {
  				callback.apply(scope, [position.coords.latitude, position.coords.longitude]);
  			});
  		}
  		else {
  			console.error('This browser does not support geolocation');
  		}
  	}

<span id='nutshell-navi-method-emptyFnc'>  	/**
</span>  	* 空函数
  	*/
  	function emptyFnc(){
	    	
	}

	var RESPONSE_TO_CALLBACK_MAP = {
		'navi::MapEngine::MapInfo'            : 'mapInfoCb',

		'navi::Guide::GudDirectionListUpdate' : 'gudDirectionListUpdateCb',
		'navi::Guide::GudDisplayItemChange'   : 'gudDisplayItemChangeCb',
		'navi::Guide::GudPointChange'         : 'gudPointChangeCb',

		'navi::Path::PathFindResult'          : 'pathFinderResulteCb',
		'navi::Path::DeleteRoute'             : 'deleteRouteCb',

		'navi::Search::SearchResult'          : 'searchResultCb',
		'navi::Search::DetailInfoResult'      : 'detailInfoResultCb',
		'navi::Search::LogoMarkResult'        : 'logoMarkResultCb',

		'navi::Location::LocDemoRunStatus'    : 'locDemoRunStatusCb',
		'navi::server::error'				  : 'unexpectedErrorCb',
		'navi::server::close'                 : 'unexpectedCloseCb'
	};
<span id='nutshell-navi'>	/**
</span>	 * @class nutshell.navi
	 * @singleton
	 *	
	 * interface of navi
	 * 
	 */
	nutshell.navi = {
		//callbackbase 
		m_cbMgr : {},
		_centerLonLat: null,
		_carLonLat: null,
		_destinationLonLat: null,
		//cn/us/jp
		_mapType: null,
		_mapLevel: null,
		_mapInfo: null,
		_hasPath: false,
		_poiListItems: null,
		_points: [],
		_routeTotalTimeAndDistance: null,
		_routeItemList: null,
		_routeInfo: null,
		_renderComplete: false,
		_totalTimeDistanceInfo: null,
		_connected: false,
		
		hasPath: function() {
			return this._hasPath;
		},
<span id='nutshell-navi-method-registerCallback'>		/**
</span>	    * Register callback function of usb manager.
	    *		
	    * @param {String} setName Descripte the callback type.
	    * @param {Function} func Callback function.
	    */
	    registerCallback: function(setName, func){
	    	
	    	nutshell.navi.m_cbMgr.registerMyself();
	    	
	    	nutshell.navi.m_cbMgr.setCustomCallback(setName, func);
	    	
	    },
<span id='nutshell-navi-method-sendRequest'>	    /**
</span>	    * 发送请求到服务器
	    */
	    sendRequest: function(data, head) {
	    	if(!this._connected) {
	    		this.connect();
	    	}
    		naviTransfer.send(data, head);
	    },
	    ///////////////// request API  ////////////////////////////////
<span id='nutshell-navi-method-reqPinPoint'>	    /**
</span>	    * 根据gps取得该点的详细信息
	    * @param {number} [lon] 经度
		* @param {number} [lat] 纬度
	    */
	    reqPinPoint: function(lon, lat) {
	    	if(typeof lon !== 'number' || typeof lat !== 'number')
	    		return;
	    	var reqPinPoint = new naviTransfer.ReqPinPoint();
	    	var maplonlat = new naviTransfer.ReqPinPoint.MapLonLat();
	    	maplonlat.setLon(lon);
	    	maplonlat.setLat(lat);
	    	reqPinPoint.setMapLonlat(maplonlat);

	    	this.sendRequest(reqPinPoint, 'navi::Search::ReqPinPoint');

	    	SendRequest(1, 1, 1, 'nutshell.navi.reqPinPoint');
	    },
<span id='nutshell-navi-method-reqMapCenterPinPoint'>	    /**
</span>	    * 取得地图中心点的pinPoint
	    * @see reqPinPoint
	    */
	    reqMapCenterPinPoint: function() {
	    	var mapCenter = this._centerLonLat;
	    	if(mapCenter) {
	    		var lon = mapCenter.lon;
	    		var lat = mapCenter.lat;
	    		this.reqPinPoint(lon, lat);
	    	}
	    },
<span id='nutshell-navi-method-reqDefaultGenre'>	    /**
</span>		* 取得默认的类型
		* @param {number} [lon] 经度
		* @param {number} [lat] 纬度
		*/
		reqDefaultGenre: function(lon, lat) {
			var reqDefaultGenre = new naviTransfer.ReqDefaultGenre();
			if(typeof lon === 'number' &amp;&amp; typeof lat === 'number') {
				var mapLonLat = new naviTransfer.ReqDefaultGenre.MapLonLat()
				mapLonLat.setLon(lon);
				mapLonLat.setLat(lat);
				reqDefaultGenre.setMapLonlat(mapLonLat);		
				this.sendRequest(reqDefaultGenre, 'navi::Search::ReqDefaultGenre');
			}
			else {
				getLocation(function(lat, lon){
					var mapLonLat = new naviTransfer.ReqDefaultGenre.MapLonLat()
					mapLonLat.setLon(lon);
					mapLonLat.setLat(lat);
					reqDefaultGenre.setMapLonlat(mapLonLat);		
					this.sendRequest(reqDefaultGenre, 'navi::Search::ReqDefaultGenre');
				});
			}

			SendRequest(1, 1, 1, 'nutshell.navi.reqDefaultGenre');
		},
<span id='nutshell-navi-method-reqAddGenre'>		/**
</span>		* 添加类型
		* @param {string} genreName 类型的名称
		* @param {number} [lon] 经度
		* @param {number} [lat] 纬度
		*/
		reqAddGenre: function(genreName, lon, lat) {
			if(genreName === undefined || genreName == null) {
				return;
			}
			var reqAddGenre = new naviTransfer.ReqAddGenre();
			reqAddGenre.setGenreName(genreName);
			if(typeof lon === 'number' &amp;&amp; typeof lat === 'number') {
				var mapLonLat = new naviTransfer.ReqAddGenre2.MapLonLat()
				mapLonLat.setLon(lon);
				mapLonLat.setLat(lat);
				reqAddGenre.setMapLonlat(mapLonLat);		
			}
			this.sendRequest(reqAddGenre, 'navi::Search::ReqAddGenre');

			SendRequest(1, 1, 1, 'nutshell.navi.reqAddGenre');
		},
<span id='nutshell-navi-method-reqDeleteGenre'>		/**
</span>		* 删除类型
		* @param {string} genreName 类型的名称
		*/
		reqDeleteGenre: function(genreName) {
			if(genreName === undefined || genreName == null) {
				return;
			}
			var reqDeleteGenre = new naviTransfer.ReqDeleteGenre();
			reqDeleteGenre.setGenreName(genreName);
			this.sendRequest(reqDeleteGenre, 'navi::Search::ReqDeleteGenre');

			SendRequest(1, 1, 1, 'nutshell.navi.reqDeleteGenre');
		},
<span id='nutshell-navi-method-reqNearBySearch'>		/**
</span>		* 周边搜索
		* @param {string} keyword 搜索的关键字
		* @param {number} [start] 搜索结果的起始位置
		* @param {number} [count] 搜索结果的个数
		*/
		reqNearBySearch: function(keyword, start, count) {
			if(keyword === undefined || keyword == null) {
				return;
			}
			var reqNearBySearch = new naviTransfer.ReqNearBySearch();
			reqNearBySearch.setKeyword(keyword);
			if(typeof start === 'number' &amp;&amp; typeof count === 'number') {
				reqNearBySearch.setStart(start);
				reqNearBySearch.setCount(count);
			}
			var mapLonLat = new naviTransfer.ReqNearBySearch.MapLonLat();
			if(this._centerLonLat) {
				mapLonLat.setLat(this._centerLonLat.lat);
				mapLonLat.setLon(this._centerLonLat.lon);
				reqNearBySearch.setMapLonlat(mapLonLat);
				this.sendRequest(reqNearBySearch, 'navi::Search::ReqNearBySearch');
			}else {
				getLocation(function(lat, lon){
					mapLonLat.setLat(lat);
					mapLonLat.setLon(lon);
					reqNearBySearch.setMapLonlat(mapLonLat);
					this.sendRequest(reqNearBySearch, 'navi::Search::ReqNearBySearch');
				});
			}

			SendRequest(1, 1, 1, 'nutshell.navi.reqNearBySearch');
		},
<span id='nutshell-navi-method-pathFinder'>		/**
</span>		* 根据输入的points检索
		*/
		pathFinder: function(points) {
			if(!points)
				return;
			var pathFinderRequest = this.createDefaultPathFinder({
				points: points
			});

			if(pathFinderRequest)
				this.sendRequest(pathFinderRequest, 'navi::Path::PathFinderRequest');
		},
<span id='nutshell-navi-method-quickPathFinder'>		/**
</span>		* 快速检索
		*/
		quickPathFinder: function(carLocation, mapCenterLocation) {
			if(!carLocation)
				carLocation = this._carLonLat;
			if(!mapCenterLocation)
				mapCenterLocation = this._centerLonLat;
			if(!carLocation || !mapCenterLocation)
				return;
			var points = [carLocation, mapCenterLocation];
			var pathFinderRequest = this.createDefaultPathFinder({
				points: points
			});

			if(pathFinderRequest)
				this.sendRequest(pathFinderRequest, 'navi::Path::PathFinderRequest');

		},
<span id='nutshell-navi-method-destinationPathFinder'>		/**
</span>		* 根据目的地算路
		*/
		destinationPathFinder: function(destinationLonLat) {
			if(!this._carLonLat || !destinationLonLat) 
				return;
			this._destinationLonLat = destinationLonLat;
			var points = [this._carLonLat, destinationLonLat];
			var pathFinderRequest = this.createDefaultPathFinder({
				points: points
			});

			if(pathFinderRequest)
				this.sendRequest(pathFinderRequest, 'navi::Path::PathFinderRequest');
		},
<span id='nutshell-navi-method-reqChangeRouteCaculateMode'>		/**
</span>		* 修改算路模式
		* @param {number} mode 算路的模式(推荐路线，最短距离，回避高速)
		*/
		reqChangeRouteCaculateMode: function(mode) {
			if(!this._carLonLat || !this._destinationLonLat) 
				return;
			var points = [this._carLonLat, this._destinationLonLat];
			var pathFinderRequest = this.createDefaultPathFinder({
				eweight: mode,
				points: points
			});
			if(pathFinderRequest)
				this.sendRequest(pathFinderRequest, 'navi::Path::PathFinderRequest');

			SendRequest(1, 1, 1, 'nutshell.navi.reqChangeRoadCaculateMode');
		},
<span id='nutshell-navi-method-createDefaultPathFinder'>		/** 
</span>		* private
		*/
		createDefaultPathFinder: function(conditions) {
			var guidePoints = this.createGuidePoints(conditions.points);
			var conditionFlag = this.createConditionFlag(conditions.useSmartic, conditions.useFerry, conditions.useTimeRegulation, conditions.useLiveTraffic);
			var matching = this.createMatching(conditions.velocity, conditions.direction);
			var eweight = this.createEweight(conditions.eweight);
			var pipeTime = this.createPipeTime();

			if(!guidePoints || !conditionFlag || !matching || !pipeTime)
				return null;
			var pathFinderRequest = new naviTransfer.PathFinderRequest();

			pathFinderRequest.setIpointNums(guidePoints.length);
			pathFinderRequest.setSpoint(guidePoints);
			pathFinderRequest.setSConditionflag(conditionFlag);
			pathFinderRequest.setEroutetype(naviTransfer.PathFinderRequest.Type_Param.NEW_ROUTE);
			pathFinderRequest.setSmatching(matching);
			pathFinderRequest.setEweight(eweight);
			pathFinderRequest.setStime(pipeTime);

			return pathFinderRequest;
		},
<span id='nutshell-navi-method-createGuidePoints'>		/**
</span>		* private
		*/
		createGuidePoints: function(points) {
			if(points === null)
				return null;
			if(Object.prototype.toString.call(points) !== '[object Array]')
				return null;
			//算路至少需要2个点
			if(points.length &lt; 2)
				return null;
			this._points = Util.clone(points);
			var guidePoints = [];
			for(var i = 0; i &lt; points.length; i++) {
				var point = points[i];
				var pathPoint = new naviTransfer.PathFinderRequest.LonLat();
				pathPoint.setLon(long64(point.lon, false));
				pathPoint.setLat(long64(point.lat, false));

				var guidePoint = new naviTransfer.PathFinderRequest.GuidePoint();
				guidePoint.setSlonlat(pathPoint);
				guidePoint.setLinkid(long64(0, true));

				guidePoints.push(guidePoint);
			}

			return guidePoints;
		},
<span id='nutshell-navi-method-createConditionFlag'>		/**
</span>		* private
		*/
		createConditionFlag: function(useSmartic, useFerry, useTimeRegulation, useLiveTraffic) {
			var conditionFlag = new naviTransfer.PathFinderRequest.ConditionFlag();
			if(useSmartic === true) {
				conditionFlag.setUseSmartic(true);	
			}
			else {
				conditionFlag.setUseSmartic(false);	
			}

			if(useFerry === true) {
				conditionFlag.setUseFerry(true);
			}
			else {
				conditionFlag.setUseFerry(false);
			}

			if(useTimeRegulation === true) {
				conditionFlag.setUseTimeRegulation(true);
			}
			else {
				conditionFlag.setUseTimeRegulation(false);
			}

			if(useLiveTraffic === true) {
				conditionFlag.setUseLiveTraffic(true);
			}
			else {
				conditionFlag.setUseLiveTraffic(false);
			}
			
			return conditionFlag;
		},
<span id='nutshell-navi-method-createMatching'>		/**
</span>		* private
		*/
		createMatching: function(velocity, direction) {
			var carLocation = this._carLonLat;
			if(!carLocation)
				return null;
			var matching = new naviTransfer.PathFinderRequest.Matching();
			var matchingLonLat = new naviTransfer.PathFinderRequest.LonLat();
			matchingLonLat.setLon(long64(carLocation.lon, false));
			matchingLonLat.setLat(long64(carLocation.lat, false));
			matching.setSposition(matchingLonLat);
			matching.setMatchinglinkid(long64(0, true));
			if(velocity &amp;&amp; typeof velocity === 'number') {
				matching.setVelocity(velocity);
			}
			else {
				matching.setVelocity(0.2);
			}
			if(direction &amp;&amp; typeof direction === 'number') {
				matching.setDirection(direction);
			}
			else {
				matching.setDirection(1);
			}
			return matching;
		},
<span id='nutshell-navi-method-createEweight'>		/**
</span>		* private
		*/
		createEweight: function(eweight) {
			if(!eweight)
				return [naviTransfer.PathFinderRequest.Weight_Param.WEIGHT_DEFAULT];
			switch(eweight) {
				case this.ROUTE_MODE[RECOMMEND_LINE_MODE]:
					return [naviTransfer.PathFinderRequest.Weight_Param.WEIGHT_DEFAULT];
				case this.ROUTE_MODE[RECOMMEND_LINE_MODE]:
					return [naviTransfer.PathFinderRequest.Weight_Param.SHORTEST_LINE_MODE];
				case this.ROUTE_MODE[RECOMMEND_LINE_MODE]:
					return [naviTransfer.PathFinderRequest.Weight_Param.HIGHWAY_AVOID_MODE];
			}
		},
<span id='nutshell-navi-method-createPipeTime'>		/**
</span>		* private
		*/
		createPipeTime: function() {
			var date = new Date();
			var pipeTime = new naviTransfer.PathFinderRequest.PipeTime();
			pipeTime.setYear(date.getFullYear());
			pipeTime.setMonth(date.getMonth());
			pipeTime.setDate(date.getDate());
			pipeTime.setWeek(date.getDay());
			pipeTime.setHour(date.getHours());
			pipeTime.setMinute(date.getMinutes());
			pipeTime.setSecond(date.getSeconds());
			return pipeTime;
		},
<span id='nutshell-navi-method-reqAnotherRoad'>		/**
</span>		* 切换路线
		*/
		reqAnotherRoad: function() {
			this.sendRequest('navi::Location::LocRecReqAnotherRoad');
		},
<span id='nutshell-navi-method-reqAreaList'>		/**
</span>		* 获取到达该地区路线的集合
		* @param {string} areacode 地区的code值
		* @param {number} [lon] 经度
		* @param {number} [lat] 纬度 
		*/
		reqAreaList: function(areacode, lon, lat) {
			if(areacode === undefined || areacode == null) {
				return;
			}
			var reqAreaList = new naviTransfer.ReqAreaList();
			reqAreaList.setAreacode(areacode);
			if(typeof lon === 'number' &amp;&amp; typeof lat === 'number') {
				var mapLonLat = new naviTransfer.ReqAreaList.MapLonLat()
				mapLonLat.setLon(lon);
				mapLonLat.setLat(lat);
				reqAreaList.setMapLonlat(mapLonLat);		
			}
			this.sendRequest(reqAreaList, 'navi::Path::ReqAreaList');

			SendRequest(1, 1, 1, 'nutshell.navi.reqAreaList');
		},
<span id='nutshell-navi-method-reqInputHelp'>		/**
</span>		* 获取输入帮助
		* @param {string} keyword 输入的关键字
		*/
		reqInputHelp: function(keyword) {
			if(keyword === undefined || keyword === null) {
				return;
			}
			var reqInputHelp = new naviTransfer.ReqInputHelp();
			reqInputHelp.setKeyword(keyword);
			getLocation(function(lat, lon){
				var mapLonLat = new naviTransfer.ReqInputHelp.MapLonLat();
				mapLonLat.setLat(lat);
				mapLonLat.setLon(lon);
				reqInputHelp.setMapLonlat(mapLonLat);
				this.sendRequest(reqInputHelp, 'navi::Path::ReqInputHelp');
			});

			SendRequest(1, 1, 1, 'nutshell.navi.reqInputHelp');
		},
<span id='nutshell-navi-method-reqInputHistory'>		/**
</span>		* 获取输入历史
		* @param {string} userid 用户的id
		*/
		reqInputHistory: function(userid) {
			if(userid === undefined || userid === null) {
				return;
			}
			var reqInputHistory = new naviTransfer.ReqInputHistory();
			reqInputHistory.setUserid(userid, 'navi::Path::ReqInputHistory');

			this.sendRequest(reqInputHistory, 'navi::Path::ReqInputHistory');
			
			SendRequest(1, 1, 1, 'nutshell.navi.reqInputHistory');
		},
<span id='nutshell-navi-method-moveMapCenterToLocation'>		/**
</span>	  	* 将地图中心点设为给定的经纬度值
	  	* @param {object} location 经纬度对象
	  	*/
	  	moveMapCenterToLocation: function(location) {
	  		if(!location)
	  			return;
	  		var lon = location.lon;
	  		var lat = location.lat;
	  		var mapSet = new naviTransfer.MapSet();
	  		var mapLonLat = new naviTransfer.MapSet.MapLonLat();
	  		mapLonLat.setLon(lon);
	  		mapLonLat.setLat(lat);
	  		mapSet.setMapLonlat(mapLonLat);

	  		if(this._mapInfo) {
	  			var mapHeight = this._mapInfo.getMapHeight();
	  			mapSet.setMapHeight(mapHeight);
	  		}

	  		this.sendRequest(mapSet, 'navi::MapEngine::MapSet');
	  	},
<span id='nutshell-navi-method-reqDeleteRoute'>	  	/**
</span>	  	* 删除路线
	  	*/
	  	reqDeleteRoute: function() {
	  		var deleteRouteRequest = new naviTransfer.ReqDeleteRoute();
	  		deleteRouteRequest.setObjectId(naviTransfer.ReqDeleteRoute.Delete_ObjectID.DELETE_OBJ_UI);

	  		this.sendRequest(deleteRouteRequest, 'navi::Path::ReqDeleteRoute');
	  	},
	  	deleteRouteCb: function(deleteRouteProto) {
	  		console.log(deleteRouteProto);
	  		if(!deleteRouteProto) {
	  			var result = deleteRouteProto.getObjectId();
	  			if(result === naviTransfer.DeleteRoute.Delete_ObjectID.DELETE_OBJ_PATH) {
	  				this._hasPath = false;
	  			}
	  		}
	  	},
<span id='nutshell-navi-method-reqRouteStatus'>	  	/**
</span>	  	* 获取当前是否有路线
	  	*/
	  	reqRouteStatus: function() {
	  		var reqRouteStatus = new naviTransfer.ReqRouteStatus();
	  		reqRouteStatus.setObjectId(naviTransfer.ReqRouteStatus.Request_ObjectID.REQUEST_OBJ_UI);

	  		naviTransfer.send(reqRouteStatus, 'navi::Path::ReqRouteStatus');
	  	},
<span id='nutshell-navi-method-startDemoRun'>	    /**
</span>	    * 开始自动走行
	    */
	    startDemoRun: function(speed) {
	    	var locRecReqDemo = new naviTransfer.LocRecReqDemo();
	    	if(speed === undefined) {
	    		locRecReqDemo.setDemoType(naviTransfer.LocRecReqDemo.LOC_DemoType.LOC_DEMOTYPE_Start);	
	    	}
	    	else {
	    		locRecReqDemo.setDemoType(naviTransfer.LocRecReqDemo.LOC_DemoType.LOC_DEMOTYPE_SetVel);	
	    		locRecReqDemo.setDemoVel(speed)
	    	}
	    	
	    	this.sendRequest(locRecReqDemo, 'navi::Location::LocRecReqDemo');
	    },
<span id='nutshell-navi-method-stopDemoRun'>	    /**
</span>	    * 停止自动走行
	    */
	    stopDemoRun: function() {
	    	var locRecReqDemo = new naviTransfer.LocRecReqDemo();
	    	locRecReqDemo.setDemoType(naviTransfer.LocRecReqDemo.LOC_DemoType.LOC_DEMOTYPE_Stop);
	    	this.sendRequest(locRecReqDemo, 'navi::Location::LocRecReqDemo');
	    },
	    ///////////////// local data API  ////////////////////////////////
<span id='nutshell-navi-method-initialize'>	    /**
</span>		  * navi模块初始化方法
		  */
		initialize: function() {
			console.log('call initialize');
			naviTransfer.initialize();

			SendRequest(1, 1, 1, 'nutshell.navi.initialize');
		},
<span id='nutshell-navi-method-connect'>		/**
</span>		* 连接navi服务
		*/
		connect: function() {
			naviTransfer.connect({
				onopen: function(){
					console.log('connect opened');
					this._connected = true;
				},
				onmessage: function(wireType, wireData){
					var callback = RESPONSE_TO_CALLBACK_MAP[wireType];
					if(callback) {
						this[callback](wireData)
					}
					else {
						console.warn('unexpected data');
					}
				},
				onclose: function(){
					console.warn('connect closed.');
					this._connected = false;
				},
				onerror: function(){
					console.error('there is something wrong on websocket.');
					this._connected = false;
				},
				scope: this
			});
		},
<span id='nutshell-navi-method-isConnected'>		/**
</span>		* 返回websocket是否连接
		*/
		isConnected: function() {
			return this._connected;
		},
<span id='nutshell-navi-method-renderMap'>		/**
</span>		* 这个方法的出现只是因为底层通讯有问题，发送过去的包会被丢弃，指不定哪次开始不丢弃
		* 发送过去的包了，所以需要不停发送包过去，直到底层返回一个数据包，这时就可以正式的
		* 通讯了
		*/
		renderMap: function() {
			if(typeof nutshell.navi.connected === 'undefined')
				nutshell.navi.connected = false;
			nutshell.navi.connectId = setInterval('nutshell.navi.start()', 1000);
		},
<span id='nutshell-navi-method-start'>		/**
</span>		* navi模块地图绘制方法
		*/
		start: function() {
			var mapOperator = new naviTransfer.MapOperator();
			mapOperator.setOperatorType(naviTransfer.MapOperator.OperatorType.MAPRUNMODE);
			mapOperator.setMapRunFlag(true);

			naviTransfer.send(mapOperator, 'navi::MapEngine::MapOperator');

			SendRequest(1, 1, 1, 'nutshell.navi.start');
		},

<span id='nutshell-navi-method-stop'>		/**
</span>		* navi模块地图清除方法
		*/
		stop: function() {
			var mapOperator = new naviTransfer.MapOperator();
			mapOperator.setOperatorType(naviTransfer.MapOperator.OperatorType.MAPRUNMODE);
			mapOperator.setMapRunFlag(false);

			this.sendRequest(mapOperator, 'navi::MapEngine::MapOperator');

			SendRequest(1, 1, 1, 'nutshell.navi.stop');
		},
<span id='nutshell-navi-method-scaleUpDown'>		  /**
</span>		  * 放大或者缩小地图
		  * @param {boolean} isup true缩小比例尺, 相反扩大比例尺
		  */
		scaleUpDown: function(isup) {
			var mapOperator = new naviTransfer.MapOperator();
			if(typeof isup !== 'boolean') {
				return;
			}
			mapOperator.setOperatorType(naviTransfer.MapOperator.OperatorType.SCALEOPERATION);
			var scaleOperation = new naviTransfer.MapOperator.ScaleOperation();
			scaleOperation.setUpFlag(isup);
			mapOperator.setScaleOperation(scaleOperation);
			this.sendRequest(mapOperator, 'navi::MapEngine::MapOperator');

			SendRequest(1, 1, 1, 'nutshell.navi.scaleUpDown');
		},
<span id='nutshell-navi-method-mapMove'>		  /**
</span>		  * 地图移动
		  * @param {number} startX 移动开始时屏幕的x坐标
		  * @param {number} startY 移动开始时屏幕的y坐标
		  * @param {number} startTimer 移动开始时距离1970年的毫秒数
		  * @param {number} stopX 移动结束时屏幕的x坐标
		  * @param {number} stopY 移动结束时屏幕的y坐标
		  * @param {number} stopTimer 移动结束时距离1970年的毫秒数
		  * @param {boolean} endFlag 拖动是否结束
		  */
		mapMove: function(startX, startY, startTimer, stopX, stopY, stopTimer, endFlag) {
			if(typeof startX !== 'number' || typeof startY !== 'number' || typeof startTimer !== 'number'
				|| typeof stopX !== 'number' || typeof stopY !== 'number' || typeof stopTimer !== 'number')
				return;
			var mapOperator = new naviTransfer.MapOperator();
			var startPoint = createMapOperatorPoint(startX, startY, startTimer);
			var endPoint = createMapOperatorPoint(stopX, stopY, stopTimer);
			var mapScroll = new naviTransfer.MapOperator.MapScroll();
			mapOperator.setOperatorType(naviTransfer.MapOperator.OperatorType.MAPSCROLL);
			mapScroll.setStartPoint(startPoint);
			mapScroll.setEndPoint(endPoint);
			mapOperator.setMapScroll(mapScroll);
			mapScroll.setEndFlag(endFlag);
			mapOperator.setCarposModeFlag(false);
			this.sendRequest(mapOperator, 'navi::MapEngine::MapOperator');

			SendRequest(1, 1, 1, 'nutshell.navi.mapMove');
		},
<span id='nutshell-navi-method-mapRotate'>		/**
</span>		* 地图旋转
		* @param {array} startPoints 旋转开始的点
		* @param {array} endPoints 旋转结束的点
		* @param {boolean} endFlag 旋转是否结束
		*/
		mapRotate: function(startPoints, endPoints, endFlag) {
			if(Object.prototype.toString.call(startPoints) !== '[object Array]' 
				|| startPoints.length &lt; 2
				|| Object.prototype.toString.call(endPoints) !== '[object Array]' 
				|| endPoints.length &lt; 2) {
				return;
			}
			endFlag = endFlag || false;
			var startPoint1 = startPoints[0];
			var startPoint2 = startPoints[1];
			var endPoint1 = endPoints[0];
			var endPoint2 = endPoints[1];
			var mapOperator = new naviTransfer.MapOperator();
			mapOperator.setOperatorType(naviTransfer.MapOperator.OperatorType.MULTIFINGEROPERATION);
			var multiFingerOperation = new naviTransfer.MapOperator.MultiFingerOperation();
			var protoStartPoint1 = createMapOperatorPoint(startPoint1.x, startPoint1.y, startPoint1.time);
			var protoStartPoint2 = createMapOperatorPoint(startPoint2.x, startPoint2.y, startPoint2.time);
			var protoEndPoint1 = createMapOperatorPoint(endPoint1.x, endPoint1.y, endPoint1.time);
			var protoEndPoint2 = createMapOperatorPoint(endPoint2.x, endPoint2.y, endPoint2.time);
			multiFingerOperation.setStartPoint1(protoStartPoint1);
			multiFingerOperation.setStartPoint2(protoStartPoint2);
			multiFingerOperation.setEndPoint1(protoEndPoint1);
			multiFingerOperation.setEndPoint2(protoEndPoint2);
			multiFingerOperation.setEndFlag(endFlag);
			mapOperator.setMultifingerOperation(multiFingerOperation);

			this.sendRequest(mapOperator, 'navi::MapEngine::MapOperator');
		},
<span id='nutshell-navi-method-addRealRoadLayer'>		/**
</span>		* 添加实时路况图层
		*/
		addRealRoadLayer: function() {
			var mapSet = new naviTransfer.MapSet();
			mapSet.setMapTrafficState(1);
			this.sendRequest(mapSet, 'navi::MapEngine::MapSet');

			SendRequest(1, 1, 1, 'nutshell.navi.addRealRoadLayer');
		},
<span id='nutshell-navi-method-removeRealRoadLayer'>		/**
</span>		* 删除实时路况图层
		*/
		removeRealRoadLayer: function() {
			var mapSet = new naviTransfer.MapSet();
			mapSet.setMapTrafficState(0);
			this.sendRequest(mapSet, 'navi::MapEngine::MapSet');

			SendRequest(1, 1, 1, 'nutshell.navi.removeRealRoadLayer');
		},
<span id='nutshell-navi-method-addFavoriteLayer'>		 /**
</span>		 * 添加收藏点图层，现在收藏点保存在本地，后台没服务器支持，不能同步到服务器
		 * 底层不知道收藏点有哪些，这里是否需要将收藏点信息抽取出来，传一个数组，那
		 * 这个方法名称需要改变，不能叫addFavoriteLayer()，只能叫addLayer(palceInfoList)
		 */
		addFavoriteLayer: function() {
			var mapSet = new naviTransfer.MapSet();
			mapSet.setMapTrafficState(1);
			this.sendRequest(mapSet, 'navi::MapEngine::MapSet');

			SendRequest(1, 1, 1, 'nutshell.navi.addFavoriteLayer');
		},
<span id='nutshell-navi-method-removeFavoriteLayer'>		/**
</span>		* 删除收藏点图层
		*/
		removeFavoriteLayer: function() {
			var mapSet = new naviTransfer.MapSet();
			mapSet.setMapTrafficState(0);
			this.sendRequest(mapSet, 'navi::MapEngine::MapSet');

			SendRequest(1, 1, 1, 'nutshell.navi.removeFavoriteLayer');
		},
<span id='nutshell-navi-method-addAroundEventLayer'>	    /**
</span>	    * 添加周边事件图层
	    */
		addAroundEventLayer: function() {
			var mapSet = new naviTransfer.MapSet();
			mapSet.setMapSNSMarkState(1);
			this.sendRequest(mapSet, 'navi::MapEngine::MapSet');

			SendRequest(1, 1, 1, 'nutshell.navi.addAroundEventLayer');
		},
<span id='nutshell-navi-method-removeAroundEventLayer'>		/**
</span>	    * 删除周边事件图层
	    */
		removeAroundEventLayer: function() {
			var mapSet = new naviTransfer.MapSet();
			mapSet.setMapSNSMarkState(0);
			this.sendRequest(mapSet, 'navi::MapEngine::MapSet');

			SendRequest(1, 1, 1, 'nutshell.navi.removeAroundEventLayer');
		},
<span id='nutshell-navi-method-searchResultCb'>	    /**
</span>	    * 类型列表变化时的回调函数
	    * @param {object} searchResult SearchResult.Proto
	    */
	  	searchResultCb: function(searchResultProto) {
	  		console.log(searchResultProto);
	  		if(!searchResultProto)
	  			return;
	  		var dataType = searchResultProto.getDataType();
	  		switch (dataType) {

		  	case naviTransfer.SearchResult.UIC_SCM_LIST_ID.POI: 
		  		var poiListItems = searchResultProto.getPoiData();
		  		nutshell.navi.m_cbMgr.handle('poiListItemsUpdateCb', {
		  			poiList: poiListItems
		  		});
		  		break;
		  	case naviTransfer.SearchResult.UIC_SCM_LIST_ID.AREA: 
		  		var aremListItems = searchResultProto.getAreaData();
		  		//TODO 
		  		break;
		  	case naviTransfer.SearchResult.UIC_SCM_LIST_ID.GENRE: 
		  		var genreListItems = searchResultProto.getGenreData();
		  		nutshell.navi.m_cbMgr.handle('genreListUpdateCb', {
		  			genreList: genreListItems
		  		});
		  		break;
		  	case naviTransfer.SearchResult.UIC_SCM_LIST_ID.INPUT_HISTORY: 
		  		var inputHistoryListItems = searchResultProto.getInputHistoryData();
		  		//TODO 
		  		break;
		  	case naviTransfer.SearchResult.UIC_SCM_LIST_ID.INPUT_HELP: 
		  		var inputHelpListItems = searchResultProto.getInputHelpData();
		  		//TODO 
		  		break;
	  		}
	  		var genreSysCount = searchResultProto.getDefaultGenreSysCount();
	  		if(typeof genreSysCount === 'number') {
	  			nutshell.navi.m_cbMgr.handle('genreSysCountUpdateCb', {
		  			genreSysCount: genreSysCount
		  		});
	  		}
 	  	},

<span id='nutshell-navi-method-mapInfoCb'>	    /**
</span>	    * map地图信息发生变化后的回调函数
	    */
	    mapInfoCb: function(mapInfoProto) {
	    	//清除调用 @see nutshell.navi.renderMap
	    	if(typeof nutshell.navi.connectId !== 'undefined') {
	    		clearInterval(nutshell.navi.connectId);
	    		delete nutshell.navi.connectId;
	    	}
	    	console.log(mapInfoProto);
	    	if(!mapInfoProto) 
	    		return;
	    	this._mapInfo = mapInfoProto;
	    	//地图中心点位置
	    	var centerLonLat = mapInfoProto.getMapLonlat();
	    	//自车
	    	var carLonLat = mapInfoProto.getCarLonlat();      
	    	if(centerLonLat) {
	    		if(!this._centerLonLat) {
	    			this._centerLonLat = {};
	    		}
	    		this._centerLonLat.lon = centerLonLat.getLon();
	    		this._centerLonLat.lat = centerLonLat.getLat();
	    		nutshell.navi.m_cbMgr.handle('mapCenterUpdateCb');
	    	}
	    	if(carLonLat) {
	    		if(!this._carLonLat) {
	    			this._carLonLat = {};
	    		}
	    		this._carLonLat.lon = carLonLat.getLon();
	    		this._carLonLat.lat = carLonLat.getLat();
	    	}
	    	this._mapLevel = mapInfoProto.getMapLevel();
	    	//地图已经绘制好
	    	var mapReplyRunFlag = mapInfoProto.getMapReplyRunFlag();
	    	if(mapReplyRunFlag === true) {
	    		if(!this._renderComplete) {
	    			//必须要调用次scaleUpDown或者move，地图才能发回来一些有意思的数据
		    		//像自车位置，地图中心点之类的信息
	    			nutshell.navi.scaleUpDown(true);
		    		this._renderComplete = true;
		    		nutshell.navi.m_cbMgr.handle('mapRenderCompleteCb');
		    		// this.moveMapCenterToLocation();
		    	}
	    	}
	    	var countryKind = mapInfoProto.getCountryKind();
	    	if(countryKind === naviTransfer.MapInfo.Country_Kind.CHINA) {
	    		this._mapType = 'cn'
	    	}
	    	else if(countryKind === naviTransfer.MapInfo.Country_Kind.JAPAN) {
	    		this._mapType = 'jp'
	    	}
	    	else if(countryKind === naviTransfer.MapInfo.Country_Kind.USA) {
	    		this._mapType = 'us'
	    	}
	    	//地图比例尺信息
	    	var scaleInfo = mapInfoProto.getScaleInfo();
	    	if(scaleInfo) {
	    		nutshell.navi.m_cbMgr.handle('mapScaleInfoCb', {scaleInfo: scaleInfo});	
	    	}
	    },
	    getMapInfo: function() {
	    	return this._mapInfo;
	    },
<span id='nutshell-navi-method-mapRenderCompleteCb'>	    /** 
</span>	    * 地图绘制完成后的callback
	    */
	    mapRenderCompleteCb: function() {
	    	return true;
	    },
<span id='nutshell-navi-method-mapCenterUpdateCb'>	    /**
</span>	    * 地图中心点变更callback
	    */
	    mapCenterUpdateCb: function() {
	    	return true;
	    },
	    mapScaleInfoCb: function() {
	    	return true;
	    },
<span id='nutshell-navi-method-pathFinderResulteCb'>	    /**
</span>	    * 搜索路线后的回调
	    */
	    pathFinderResulteCb: function(pathFinderResulteProto) {
	    	console.log(pathFinderResulteProto);
	    	if(!pathFinderResulteProto)
	    		return;
	    	var routeInfo = pathFinderResulteProto.getRoute();

        	if(routeInfo) {
        		var routeLength = routeInfo.getRouteLength();
        		var routeTime = routeInfo.getRouteTime();

        		nutshell.navi.m_cbMgr.handle('routeTotalTimeAndDistanceUpdateCb', {routeTotalTimeAndDistance: {
        			routeLength: routeLength,
        			routeTime: routeTime
        		}});
        	}
        	var findMessage = pathFinderResulteProto.getFindMessage();
        	if(findMessage === naviTransfer.PathFindResult.PathFindMessage.PATH_ERR_MSG_NO_ERROR) {
        		success = true;
        	}
        	else {
        		success = false;
        	}
        	nutshell.navi.m_cbMgr.handle('pathFinderCompleteCb', {success: {
        		success: success
        	}});
        	if(success) {
        		this._hasPath = true;
        	}
	    },
	    pathFinderCompleteCb: function() {
	    	return true;
	    },
	    routeTotalTimeAndDistanceUpdateCb: function(routeTotalTimeAndDistance) {
	    	this._routeTotalTimeAndDistance = routeTotalTimeAndDistance;
	    	return true;
	    },
	    getRouteTotalTimeAndDistance: function() {
	    	return this._routeTotalTimeAndDistance;
	    },
<span id='nutshell-navi-method-gudDirectionListUpdateCb'>	    /**
</span>	    * 路线更新后的回调
	    */
	    gudDirectionListUpdateCb: function(gudDirectionListUpdateProto) {
	    	console.log(gudDirectionListUpdateProto);
	    	if(!gudDirectionListUpdateProto)
	    		return;
	    	var state = gudDirectionListUpdateProto.getIState();
	    	if(state === naviTransfer.GudDirectionListUpdate.DIRECTION_LIST_STATE.DIRECTION_LIST_REFRESH) {
	    		var routeItemList = [];
	    		//数据条数
	    		var itemNumber = gudDirectionListUpdateProto.getIPointNum();
	    		//距离
	    		var iItemInfoPointDisList = gudDirectionListUpdateProto.getIItemInfoPointDis();
	    		//方向
	    		var iItemInfoPointDirList = gudDirectionListUpdateProto.getIItemInfoPointDir();
	    		//街道名称
	    		var strItemInfoNextStreetNameList = gudDirectionListUpdateProto.getStrItemInfoNextStreetName();
	    		//箭头类型
	    		var iItemInfoPointKindList = gudDirectionListUpdateProto.getIItemInfoPointKind();
	    		//经度
	    		var itemInfoPointLonList = gudDirectionListUpdateProto.getItemInfoPointLon();
	    		//纬度
	    		var itemInfoPointLatList = gudDirectionListUpdateProto.getItemInfoPointLat();
	    		//确保数据是正确的
	    		if(!iItemInfoPointDisList || iItemInfoPointDisList.length !== itemNumber) {
	    			console.warn('GudDirectionListUpdate has the wrong data.');
	    			return;
	    		}
	    		if(!iItemInfoPointDirList || iItemInfoPointDirList.length !== itemNumber) {
	    			console.warn('GudDirectionListUpdate has the wrong data.');
	    			return;
	    		}
	    		if(!strItemInfoNextStreetNameList || strItemInfoNextStreetNameList.length !== itemNumber) {
	    			console.warn('GudDirectionListUpdate has the wrong data.');
	    			return;
	    		}
	    		if(!iItemInfoPointKindList || iItemInfoPointKindList.length !== itemNumber) {
	    			console.warn('GudDirectionListUpdate has the wrong data.');
	    			return;
	    		}
	    		if(!itemInfoPointLonList || itemInfoPointLonList.length !== itemNumber) {
	    			console.warn('GudDirectionListUpdate has the wrong data.');
	    			return;
	    		}
	    		if(!itemInfoPointLatList || itemInfoPointLatList.length !== itemNumber) {
	    			console.warn('GudDirectionListUpdate has the wrong data.');
	    			return;
	    		}
	    		for(var i = 0; i &lt; itemNumber; i++) {
	    			routeItemList.push({
						direction  : iItemInfoPointDirList[i],
						streetName : strItemInfoNextStreetNameList[i],
						distance   : iItemInfoPointDisList[i],
						itemKind   : iItemInfoPointKindList[i],
						//long类型
						lon        : itemInfoPointLonList[i].low,
						//long类型
						lat        : itemInfoPointLatList[i].low,
	    			});
	    		}
	    		nutshell.navi.m_cbMgr.handle('routeItemListUpdateCb', {routeItemList: routeItemList});	
	    	}else {
	    		nutshell.navi.m_cbMgr.handle('routeItemListUpdateCb', {routeItemList: []});	
	    	}
	    },
	    routeItemListUpdateCb: function(routeItemList) {
	    	this._routeItemList = routeItemList;
	    	return true;
	    },
	    getRouteItemList: function() {
	    	return this._routeItemList;
	    },
	    logoMarkResultCb: function(logoMarkResultProto) {
	    	console.log(logoMarkResultProto);
	    },
	    locDemoRunStatusCb: function(locDemoRunStatusProto) {
	    	console.log(locDemoRunStatusProto);
	    	if(!locDemoRunStatusProto)
	    		return;
	    	var demorunStatus = locDemoRunStatusProto.getDemorunStatus();
	    	var start = false;
	    	var stop = false;
	    	if(demorunStatus === naviTransfer.LocDemoRunStatus.LOC_DemoRunStatus.LOC_DEMORUN_STATUS_Start) {
	    		start = true;
	    		stop = false;
	    	}
	    	else {
	    		start = false;
	    		stop = true;
	    	}
	    	nutshell.navi.m_cbMgr.handle('demoRunStatusUpdateCb', {status: {
	    		start: start,
	    		stop: stop
	    	}});
	    },
	    demoRunStatusUpdateCb: function() {
	    	return true;
	    },
<span id='nutshell-navi-method-gudDisplayItemChangeCb'>	    /**
</span>	    * gud item更新回调
	    */
	    gudDisplayItemChangeCb: function(gudDisplayItemChangeProto) {
	    	console.log(gudDisplayItemChangeProto);
	    	if(!gudDisplayItemChangeProto)
	    		return;
	    	var iDispStatus = gudDisplayItemChangeProto.getIDispStatus();
	    	//DPGUDEF_CMN_ROUTEINFO(0x00000001)代表数据准备好了,可以画DEMO走行界面
	    	if(iDispStatus &amp; naviTransfer.GudDisplayItemChange.DispType.DPGUDEF_CMN_ROUTEINFO) {
	    		nutshell.navi.m_cbMgr.handle('routeInfoReadyCb');
	    		var cDispRouteInfo = gudDisplayItemChangeProto.getCDispRouteInfo();
	    		if(cDispRouteInfo) {
	    			var strNextStreetName = cDispRouteInfo.getMStrNextStreetName();
	    			var arrowKind = cDispRouteInfo.getMIArrowKind();
	    			var distance = cDispRouteInfo.getMStrKMDistance();
	    			nutshell.navi.m_cbMgr.handle('routeInfoUpdateCb', {routeInfo: {
						streetName : strNextStreetName,
						distance   : distance,
						direction  : arrowKind
	    			}});
	    		}
	    	}

	    	if(iDispStatus &amp; naviTransfer.GudDisplayItemChange.DispType.DPGUDEF_CMN_STREETNAME) {
	    		var cDispCurRoadInfo = gudDisplayItemChangeProto.getCDispCurRoadInfo();
	    		if(cDispCurRoadInfo) {
	    			var streetName = cDispCurRoadInfo.getMStrStreetName();
	    			nutshell.navi.m_cbMgr.handle('streetNameUpdateCb', {streetName: streetName});
	    		}
	    	}

	    	if(iDispStatus &amp; naviTransfer.GudDisplayItemChange.DispType.DPGUDEF_CMN_ETAINFO) {
	    		var etaInfo = gudDisplayItemChangeProto.getCDispETAInfo();
	    		if(etaInfo) {
	    			//距离
	    			var distance = etaInfo.getMStrKMDistToDest();
	    			//估算将要花费的时间
	    			var spendTime = etaInfo.getMStrDestETR();
	    			//估算到达时的时间
	    			var arriveTime = etaInfo.getMStrDestETA();

	    			var timeKind = etaInfo.getMETimeKind();
	    			var distanceKind = etaInfo.getMEDistanceKind();
	    			//表示time结果无效
	    			if(timeKind === naviTransfer.GudDisplayItemChange.GudETAInfo.GUD_TIMEKIND.DPGUDEF_CMN_SIGN_TIMEKIND_INVALID) {
	    				spendTime = false;
	    				arriveTime = false;
	    			}
	    			if(distanceKind === naviTransfer.GudDisplayItemChange.GudETAInfo.GUD_DISTKIND.DPGUDEF_CMN_SIGN_DISTKIND_INVALID) {
	    				distance = false;
	    			}
	    			nutshell.navi.m_cbMgr.handle('totalTimeDistanceInfoUpdateCb', {etaInfo: {
						spendTime  : spendTime,
						arriveTime : arriveTime,
						distance   : distance
	    			}});
	    		}
	    	}
	    },
	    routeInfoUpdateCb: function(routeInfo) {
	    	this._routeInfo = routeInfo;
	    	return true;
	    },
	    getRouteInfo: function() {
	    	return this._routeInfo;
	    },
	    totalTimeDistanceInfoUpdateCb: function(etaInfo) {
	    	this._totalTimeDistanceInfo = etaInfo;
	    	return true;
	    },
	    getTotalTimeDistanceInfo: function() {
	    	return this._totalTimeDistanceInfo;
	    },
	    routeInfoReadyCb: function() {
	    	return true;
	    },
	    streetNameUpdateCb: function() {
	    	return true;
	    },
	    gudPointChangeCb: function(gudPointChangeProto) {
	    	console.log(gudPointChangeProto);
	    },
<span id='nutshell-navi-method-detailInfoResultCb'>	    /**
</span>	    */
	    detailInfoResultCb: function(detailInfoResultProto) {
	    	console.log(detailInfoResultProto);
	    	if(!detailInfoResultProto)
	    		return;
	    	var detailInfo = detailInfoResultProto.getDetailinfo();
	    	if(detailInfo) {
				nutshell.navi.m_cbMgr.handle('pinPointUpdateCb', {pinPoint: detailInfo});	    		
	    	}
	    },

<span id='nutshell-navi-method-pinPointUpdateCb'>	    /**
</span>	    * pinPointUpdateCb
	    * 
	    *  @param {@link detailInfo} : pinPoint
	    */
	    pinPointUpdateCb: function() {
	    	return true;
	    },
	    genreListUpdateCb: function() {
	    	return true;
	    },
	    genreSysCountUpdateCb: function() {
	    	return true;
	    },
	    poiListItemsUpdateCb: function(poiListItems) {
	    	this._poiListItems = poiListItems;
	    	return true;
	    },
	    //////// 缓存的数据 /////
<span id='nutshell-navi-method-getCenterLonLat'>	    /**
</span>	  	* 返回缓存的地图中心点经纬度
	  	*/
	  	getCenterLonLat: function() {
	  		return this._centerLonLat;
	  	},
<span id='nutshell-navi-method-getCarLonLat'>	  	/**
</span>	  	* 返回自车位置点
	  	*/
	  	getCarLonLat: function() {
	  		return this._carLonLat;
	  	},
	  	getDestinationLonLat: function() {
			return this._destinationLonLat;
		},
<span id='nutshell-navi-method-getPoiPoint'>	  	/**
</span>	  	* 根据经纬度返回坐标点详细信息
	  	*/
	  	getPoiPoint: function(lon, lat) {
	  		var poiListItems = this._poiListItems;
	  		if(poiListItems) {
	  			for(var i = 0; i &lt; poiListItems.length; i++) {
	  				var poiItem = poiListItems[i];
	  				if(poiItem) {
	  					var poiLon = poiItem.getPos().getLon();
	  					var poiLat = poiItem.getPos().getLat();
	  					if(poiLon == lon &amp;&amp; poiLat == lat)
	  						return poiItem;
	  				}
	  			}
	  		}
	  		return null;
	  	},
<span id='nutshell-navi-method-getSearchPoints'>	  	/**
</span>	  	* 返回最近一次算路使用的points
	  	*/
	  	getSearchPoints: function() {
	  		return this._points;
	  	},
<span id='nutshell-navi-method-moveToCarLocation'>	  	/**
</span>	  	* 将地图中心点设为自车位置
	  	*/
	  	moveToCarLocation: function() {
	  		this.changeCarPositionMode(true);
	  	},
<span id='nutshell-navi-method-changeCarPositionMode'>	  	/**
</span>	  	* 修改carpositionmode
	  	*/
	  	changeCarPositionMode: function(flag) {
	  		flag = flag || false;
	  		var mapOperator = new naviTransfer.MapOperator();
	  		mapOperator.setOperatorType(naviTransfer.MapOperator.OperatorType.INVALID_OPREATOR);
	  		mapOperator.setCarposModeFlag(flag);

	  		this.sendRequest(mapOperator, 'navi::MapEngine::MapOperator');
	  	},
<span id='nutshell-navi-method-setMapScreenId102'>	  	/**
</span>	  	* 将map screenId设为102,自车模式用
	  	*/
	  	setMapScreenId102: function() {
	  		var mapSet = new naviTransfer.MapSet();
	  		mapSet.setMapScreenId(102);
			this.sendRequest(mapSet, 'navi::MapEngine::MapSet');
	  	},
<span id='nutshell-navi-method-setMapScreenId103'>	  	/**
</span>	  	* 将map screenId设为103,拖动地图时用
	  	*/
	  	setMapScreenId103: function() {
	  		var mapSet = new naviTransfer.MapSet();
	  		mapSet.setMapScreenId(103);
			this.sendRequest(mapSet, 'navi::MapEngine::MapSet');
	  	},
	  	unexpectedErrorCb: function() {
	  		nutshell.navi.m_cbMgr.handle('serverUnexpectedErrorCb');
	  	},
	  	serverUnexpectedErrorCb: function() {
	  		return true;
	  	},
	  	unexpectedCloseCb: function() {
	  		nutshell.navi.m_cbMgr.handle('serverUnexpectedCloseCb');
	  	},
	  	serverUnexpectedCloseCb: function() {
	  		return true;
	  	},
	  	setMapOffset: function(offsetX, offsetY) {
	  		if(typeof offsetX !== 'number' || typeof offsetY !== 'number') {
	  			return;
	  		}
	  		var mapSet = new naviTransfer.MapSet();
	  		var mapOffset = new naviTransfer.MapSet.MapOffset();
	  		mapOffset.setX(offsetX);
	  		mapOffset.setY(offsetY);
	  		mapSet.setMapOffset(mapOffset);
			this.sendRequest(mapSet, 'navi::MapEngine::MapSet');
	  	},
	    ROUTE_MODE: {
			'RECOMMEND_LINE_MODE' : 1,
			'SHORTEST_LINE_MODE'  : 2,
			'HIGHWAY_AVOID_MODE'  : 3
	    }
	};

	
<span id='nutshell-navi-property-m_cbMgr'>	/**
</span>	 * 
	 */
	nutshell.navi.m_cbMgr = callbackBase.createInstance();
	
	nutshell.navi.m_cbMgr.setApi(nutshell.navi);	
}());
</pre>
</body>
</html>
